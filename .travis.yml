sudo: false

language: go

os:
  - linux
  - osx

branches:
  only:
    - master

go:
  - 1.5
  - tip

before_install:
  - go get ./...
  - go get -u github.com/golang/lint/golint
  - go get -u golang.org/x/tools/cmd/goimports
  - go get -u golang.org/x/tools/cmd/cover
  - go get -u golang.org/x/tools/cmd/vet

script:
  - go vet ./...
  - diff <(goimports -d .) <(printf "")
  - diff <(golint ./...) <(printf "")
  - go test -v -cpu=1,2,4 -race ./...
  - go test -cover ./...

matrix:
  allow_failures:
    - go: tip
